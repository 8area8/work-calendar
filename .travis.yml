sudo: required

cache:
  directories:
    - front/node_modules

language: node_js
node_js: 12

jobs:
  include:
    - stage: "Javascript unit tests"
      script: "cd front && npm install && npm run test:unit"
    - stage: "Python unit tests"
      script: "sudo apt install python3-dev libpq-dev && pip install pipenv && pipenv install && pipenv run pytest back"

deploy:
  provider: heroku
  skip_cleanup: true
  api_key:
    secure: $HEROKU_KEY
  app: thefuntains
  run: "npm run generate"
